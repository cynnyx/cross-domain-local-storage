"use strict";window.XdUtils=window.XdUtils||function(){function a(a,b){var c,d=b||{};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}return{extend:a}}(),window.xdLocalStorage=window.xdLocalStorage||function(){function a(a){m[a.id]&&m[a.id](a),delete m[a.id]}function b(b){var c;try{c=JSON.parse(b.data)}catch(a){}c&&c.namespace===j&&("iframe-ready"===c.id?o||(o=!0,k.initCallback()):a(c))}function c(a,b,c,d){l++,m[l]=d;var e={namespace:j,id:l,action:a,key:b,value:c};i.contentWindow.postMessage(JSON.stringify(e),"*")}function d(a){k=XdUtils.extend(a,k),g(),void 0!==k.iframe?f(k):void 0!==k.iframeUrl&&e(k)}function e(a){var b=document.createElement("div");b.innerHTML='<iframe id="'+a.iframeId+'" src='+a.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(b),i=document.getElementById(a.iframeId)}function f(a){i=a.iframe,c("areYouReady")}function g(){window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b)}function h(){return n?!!o||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}var i,j="cross-domain-local-message",k={iframeId:"cross-domain-iframe",iframeUrl:void 0,iframe:void 0,initCallback:function(){}},l=-1,m={},n=!1,o=!1;return{init:function(a){if(!a.iframeUrl&&!a.iframe)throw"You must specify iframeUrl or iframe";return n?void console.log("xdLocalStorage was already initialized!"):(n=!0,void("complete"===document.readyState?d(a):window.onload=function(){d(a)}))},setItem:function(a,b,d){h()&&c("set",a,b,d)},getItem:function(a,b){h()&&c("get",a,null,b)},removeItem:function(a,b){h()&&c("remove",a,null,b)},key:function(a,b){h()&&c("key",a,null,b)},getSize:function(a){h()&&c("size",null,null,a)},getLength:function(a){h()&&c("length",null,null,a)},clear:function(a){h()&&c("clear",null,null,a)},wasInit:function(){return n}}}(),angular.module("xdLocalStorage",[]).service("xdLocalStorage",["$q","$rootScope",function(a,b){function c(){if(!xdLocalStorage.wasInit())throw"You must init xdLocalStorage in app config before use";return f.promise}function d(d){var e=Array.prototype.slice.call(arguments,1);return c().then(function(){var c=a.defer();return xdLocalStorage[d].apply(this,e.concat(function(){var a=arguments[0];b.$apply(function(){c.resolve(a)})})),c.promise})}var e=!1,f=a.defer(),g=b.$watch(function(){return e},function(){f.resolve(!0),g()});return{init:function(c){var d=a.defer();return c.initCallback=function(){b.$apply(function(){e=!0,d.resolve()})},xdLocalStorage.init(c),d.promise},setItem:function(a,b){return d("setItem",a,b)},getItem:function(a){return d("getItem",a)},removeItem:function(a){return d("removeItem",a)},key:function(a){return d("key",a)},clear:function(){return d("clear")}}}]);